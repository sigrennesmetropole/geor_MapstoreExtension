stages:
    - build
    - test
    - quality
    - deployment

workflow:
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
      variables:
        PREVENT_PIPELINES: "1"
    - if: $CI_PIPELINE_SOURCE != 'merge_request_event' && $PREVENT_PIPELINES != '1'



quality:
    stage: quality
    script:
        - echo "Lancement sonarQube"
    needs:
        - test
    rules:
        - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "develop"

test:
    stage: test
    script:
        - echo "test"
    needs:
        - build

build:
    stage: build
    image: node:14-bullseye
    script: 
        - echo plop
        - cd $CI_PROJECT_DIR
        - git submodule update js/extension
        - git submodule update MapStore2
        - npm ci
        - npm run ext:build
    variables:
        GIT_SUBMODULE_STRATEGY: none
    artifacts:
        paths: 
            - dist/SampleExtension.zip
        expire_in: 1 day
